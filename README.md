### 一、项目结构

Pages页面

1、home：首页

![image-20240629154118989](./assets/image-20240629154118989.png)



2、user：用户页面

![image-20240629154228077](./assets/image-20240629154228077.png)



3、login：登录页面

![image-20240629154302032](./assets/image-20240629154302032.png)



4、favo：收藏列表

![image-20240629154402787](./assets/image-20240629154402787.png)







### 二、项目功能报告

1、搜索地点：在页面顶部，可以根据关键词搜索地点，并在地图上标注出来

![image-20240629154712708](./assets/image-20240629154712708.png)



2、收藏地址：点击任意标注点后，再点击页面底部的“收藏”图标即可加入收藏，被收藏的地址将以不同的图标标注出来

![image-20240629154952449](./assets/image-20240629154952449.png)



3、导航：点击任意标注点后，再点击页面底部的“导航”按钮即可以当前位置为起点，目标位置为终点，自动规划驾车路线，并在地图上标记出来

![image-20240629155148160](./assets/image-20240629155148160.png)



4、登录：点击头像会自动跳转至登录页面，输入账号密码点击"登录"按钮即可完成登录，并从服务器获取到个人信息

![image-20240629155514957](./assets/image-20240629155514957.png)

![image-20240629155608184](./assets/image-20240629155608184.png)

![image-20240629155627200](./assets/image-20240629155627200.png)



5、收藏列表：在“收藏列表”界面展示所有已收藏的地址

![image-20240629155835167](./assets/image-20240629155835167.png)



6、联系作者：弹窗出作者的邮箱方便用户向作者反馈

![image-20240629155941048](./assets/image-20240629155941048.png)



7、退出登录：清空登录状态，下次打开小程序时需要重新登录

![image-20240629160101932](./assets/image-20240629160101932.png)

![image-20240629160121360](./assets/image-20240629160121360.png)



### 三、开发技术手册

1、搜索地点

- 输入关键词：在home.wxml页面顶部的输入框输入内容后，调用home.js中的getWords方法，自动监听用户的输入，并将输入保存进keywords中

| 事件函数名称 | play       |
| ------------ | ---------- |
| 传入参数     | e          |
| 返回值       | 无         |
| 功能来源     | 非课程实验 |

- 搜索：点击在home.wxml页面顶部的搜索按钮后，将调用home.js中的goSearch方法，该方法调用第三方位置API发送地点搜索请求（发送内容包括关键词，坐标），发送成功后将返回值保存在数组mks中，再mks传给页面数据markers显示

| 事件函数名称  | play                      |
| ------------- | ------------------------- |
| 传入参数      | 无                        |
| 返回值        | 无                        |
| 功能来源      | 实验六                    |
| 第三方API来源 | 腾讯位置服务-->微信小程序 |

![image-20240629162003219](./assets/image-20240629162003219.png)

![image-20240629162531616](./assets/image-20240629162531616.png)

![image-20240629163431239](./assets/image-20240629163431239.png)



2、收藏地址

- 点击目标地点保存：在home.wxml点击目标地点后，自动调用onMarkerTap方法，该方法将会将目标地点的信息保存进页面数据（thatLa，thatLo，thatId，thatTitle）

| 事件函数名称 | onMarkerTap |
| ------------ | ----------- |
| 传入参数     | event       |
| 返回值       | 无          |
| 功能来源     | 非课程实验  |

- 收藏：点击“收藏”图标会自动调用setStar方法，先将页面数据中的目标点信息打包成一个对象，然后调用wx.getFileSystemManager()示例化一个文件系统fs，然后调用JSON.stringify将数据转化成字符串，如果是第一次收藏，先调用fs的writeFile方法新建一个文件并将字符串写入，如果不是第一次收藏，则直接调用fs的appendFile方法将字符串以追加的方式写入，最后将目标地点数据传入页面数据markers中以更新地图

| 事件函数名称 | setStar |
| ------------ | ------- |
| 传入参数     | 无      |
| 返回值       | 无      |
| 功能来源     | 实验五  |

![image-20240629165922271](./assets/image-20240629165922271.png)

![image-20240629170003750](./assets/image-20240629170003750.png)

![image-20240629170039635](./assets/image-20240629170039635.png)

![image-20240629170107749](./assets/image-20240629170107749.png)

![image-20240629170133169](./assets/image-20240629170133169.png)





3、导航

- 导航：在home.wxml点击目标地点后，点击导航会自动调用goLead方法，该方法先向位置API中的距离计算接口发送请求，请求内容包括起始地点信息，也就是当前点，目标地点信息（点击目标地点后，自动调用onMarkerTap方法获取），以及出现方式（驾车），请求成功后先解压坐标，然后设置polyline属性，将路线显示出来

| 事件函数名称 | goLead |
| ------------ | ------ |
| 传入参数     | 无     |
| 返回值       | 无     |
| 功能来源     | 实验六 |



![image-20240629172338407](./assets/image-20240629172338407.png)

![image-20240629172414965](./assets/image-20240629172414965.png)

![image-20240629172437507](./assets/image-20240629172437507.png)

![image-20240629172455206](./assets/image-20240629172455206.png)



4、登录

- 后端：先导入express，和body-parser两个库，实例化express，将用户信息保存在db.user中，监听3000端口，监听post请求，如果从客户端传来的账号正确，将用户信息以json格式返回

  | 事件函数名称 | post     |
  | ------------ | -------- |
  | 传入参数     | ‘/login’ |
  | 返回值       | 无       |
  | 功能来源     | 实验四   |

![image-20240629175343738](./assets/image-20240629175343738.png)

- 跳转至登录：user.wxml页面点击头像后触发goLogin方法，跳转至登录页面

| 事件函数名称 | goLogin    |
| ------------ | ---------- |
| 传入参数     | 无         |
| 返回值       | 无         |
| 功能来源     | 非课程实验 |

![image-20240629175900648](./assets/image-20240629175900648.png)

![image-20240629175923464](./assets/image-20240629175923464.png)



- 账号密码输入：login.wxml页面的两个input框分别通过onAccountChange方法和onPasswordChange方法监听用户的输入，并保存进页面数据

| 事件函数名称 | onAccountChange |
| ------------ | --------------- |
| 传入参数     | e               |
| 返回值       | 无              |
| 功能来源     | 非课程实验      |

| 事件函数名称 | onPasswordChange |
| ------------ | ---------------- |
| 传入参数     | e                |
| 返回值       | 无               |
| 功能来源     | 非课程实验       |

![image-20240629180040320](./assets/image-20240629180040320.png)

![image-20240629180253205](./assets/image-20240629180253205.png)

- 登录：在login.wxml页面点击登录按钮调用login方法，该先向后端发送post请求，请求内容为用户信息，请求成功后，先调用  wx.getFileSystemManager()实例化一个文件管理系统fs，然后将接收的数据通过JSON.stringify方法转化为字符串，再调用fs的writeFile方法将字符串写入文件，最后调用wx.navigateBack返回用户页面

| 事件函数名称 | login          |
| ------------ | -------------- |
| 传入参数     | 无             |
| 返回值       | 无             |
| 功能来源     | 实验四，实验五 |

![image-20240629181053635](./assets/image-20240629181053635.png)

![image-20240629181126959](./assets/image-20240629181126959.png)

![image-20240629181143323](./assets/image-20240629181143323.png)

![image-20240629181158260](./assets/image-20240629181158260.png)



5、收藏列表

- 显示收藏列表：在favo.wxml页面加载完成前，onLoad方法会将文件中的地址读取出来，通过JSON.parse方法转化为对象，再将对象通过map方法存进数组，然后将数组传入页面数据mks动态显示

| 事件函数名称 | onLoad     |
| ------------ | ---------- |
| 传入参数     | 无         |
| 返回值       | 无         |
| 功能来源     | 非课程实验 |

![image-20240629172716441](./assets/image-20240629172716441.png)

![image-20240629173136602](./assets/image-20240629173136602.png)

![image-20240629173154055](./assets/image-20240629173154055.png)



6、联系作者

- 弹窗：在user.wxml点击联系作者后会调用goLink方法，该方法调用wx.showModal方法自动弹出一个模特窗口

| 事件函数名称 | goLink |
| ------------ | ------ |
| 传入参数     | 无     |
| 返回值       | 无     |
| 功能来源     | 实验七 |



![image-20240629173653119](./assets/image-20240629173653119.png)

![image-20240629173626523](./assets/image-20240629173626523.png)

![image-20240629173725720](./assets/image-20240629173725720.png)



7、退出登录

- 退出登录：点击user.wxml中部的退出登录后，会调用signOut，该方法先调用this.ini()将页面数据重置，然后实例化一个文件管理系统fs，再调用fs的unlink方法将保存用户信息的文件删除

| 事件函数名称 | signOut |
| ------------ | ------- |
| 传入参数     | 无      |
| 返回值       | 无      |
| 功能来源     | 实验五  |

![image-20240629174150125](./assets/image-20240629174150125.png)

![image-20240629174205917](./assets/image-20240629174205917.png)





